!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.minsmap=t():e.minsmap=t()}(window,(function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));const i=0,s=1,o=2,r=3;class c{constructor({url:e,pingMsg:t="ping",reconnectTimerDuration:n=3e4,pingTimerDuration:s=3e4,pongTimerDuration:o=3e4}){this.url=e,this.pingMsg=t,this.instance=null,this.status=i,this.pingTimer=null,this.pongTimer=null,this.reconnectTimer=null,this.needDestroy=!1,this.isReconnecting=!1,this.pingTimerDuration=s,this.pongTimerDuration=o,this.reconnectTimerDuration=n,this.reconnectCount=0,this.create()}create(){return"WebSocket"in window?this.url?(this.instance=new WebSocket(this.url),this._onopen(),this._onmessage(),this._onclose(),void this._onerror()):(new Error("WebSocket url不存在"),null):(new Error("当前浏览器暂不支持不支持"),null)}reconnect(){if(this.needDestroy||this.isReconnecting||this.reconnectCount>10)return null;clearTimeout(this.reconnectTimer),this.isReconnecting=!0,this.reconnectCount+=1,this.reconnectTimer=setTimeout(()=>{this.create(),this.isReconnecting=!1},this.reconnectTimerDuration)}sendPing(){this.send(this.pingMsg)}_onopen(){this.instance.onopen=e=>{clearTimeout(this.RECONNEC_TTIMER),this.status=s,this.onopen&&"function"==typeof this.onopen&&this.onopen(e)}}_onmessage(){this.instance.onmessage=e=>{this.onmessage&&"function"==typeof this.onmessage&&this.onmessage(e),this.resetPing(),this.createPing()}}_onclose(){this.instance.onclose=e=>{this.resetPing(),this.onclose&&"function"==typeof this.onclose&&this.onclose(e),this.reconnect()}}_onerror(){this.instance.onerror=e=>{this.resetPing(),this.onerror&&"function"==typeof this.onerror&&this.onerror(e),this.reconnect()}}send(e){if(this.instance.readyState===s)this.instance.send(JSON.stringify(e));else if(this.instance.readyState===i)setTimeout(()=>{this.instance.send(JSON.stringify(e))},1e3);else if(this.instance.readyState===r||this.instance.readyState===o)return null}destroy(){this.resetPing(),this.instance.close(),this.needDestroy=!0}createPing(){this.pingTimer=setTimeout(()=>{this.send(this.pingMsg),this.pongTimer=setTimeout(()=>{this.instance.close()},this.pongTimerDuration)},this.pingTimerDuration)}resetPing(){clearTimeout(this.pingTimer),clearTimeout(this.pongTimer)}}}])}));